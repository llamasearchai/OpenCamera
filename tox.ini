# Tox configuration for running Python tests across multiple versions using uv as the backend.
# It builds the C++ pybind extension before tests to validate C++/Python integration.

[tox]
envlist = py38, py39, py310, py311
requires =
    tox-uv>=1.7.0
    tox>=4.11.0
skipsdist = true

[testenv]
description = Run tests with uv backend and compiled pybind extension
runner = uv
setenv =
    OPENCAM_ENABLE_ML=0
passenv =
    CC
    CXX
    CFLAGS
    CXXFLAGS
    LDFLAGS
    PKG_CONFIG_PATH
    LD_LIBRARY_PATH
    DYLD_LIBRARY_PATH
    OPENCV_DIR
deps =
    pytest
    numpy
    pybind11
    opencv-python
    -e .
commands_pre =
    python -c "import sys; print('Python', sys.version)"
    # Build pybind extension in place
    python -c "import subprocess,sys,os; os.chdir('python/bindings'); sys.exit(subprocess.call([sys.executable,'setup.py','build_ext','--inplace']))"
commands =
    pytest -v